ARM GAS  /tmp/ccxtKKLF.s 			page 1


   1              		.syntax unified
   2              		.cpu cortex-m3
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.syntax unified
  15              		.file	"delay.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.delay_init,"ax",%progbits
  20              		.align	2
  21              		.global	delay_init
  22              		.thumb
  23              		.thumb_func
  25              	delay_init:
  26              	.LFB64:
  27              		.file 1 "./System/Src/delay.c"
   1:./System/Src/delay.c **** #include "delay.h"
   2:./System/Src/delay.c **** #include "sys.h"
   3:./System/Src/delay.c **** ////////////////////////////////////////////////////////////////////////////////// 	 
   4:./System/Src/delay.c **** //Èç¹ûĞèÒªÊ¹ÓÃOS,Ôò°üÀ¨ÏÂÃæµÄÍ·ÎÄ¼ş¼´¿É.
   5:./System/Src/delay.c **** #if SYSTEM_SUPPORT_OS
   6:./System/Src/delay.c **** #include "includes.h"					//ucos Ê¹ÓÃ	  
   7:./System/Src/delay.c **** #endif
   8:./System/Src/delay.c **** //////////////////////////////////////////////////////////////////////////////////	 
   9:./System/Src/delay.c **** //±¾³ÌĞòÖ»¹©Ñ§Ï°Ê¹ÓÃ£¬Î´¾­×÷ÕßĞí¿É£¬²»µÃÓÃÓÚÆäËüÈÎºÎÓÃÍ¾
  10:./System/Src/delay.c **** //ALIENTEK STM32¿ª·¢°å
  11:./System/Src/delay.c **** //Ê¹ÓÃSysTickµÄÆÕÍ¨¼ÆÊıÄ£Ê½¶ÔÑÓ³Ù½øĞĞ¹ÜÀí£¨ÊÊºÏSTM32F10xÏµÁĞ£©
  12:./System/Src/delay.c **** //°üÀ¨delay_us,delay_ms
  13:./System/Src/delay.c **** //ÕıµãÔ­×Ó@ALIENTEK
  14:./System/Src/delay.c **** //¼¼ÊõÂÛÌ³:www.openedv.com
  15:./System/Src/delay.c **** //´´½¨ÈÕÆÚ:2010/1/1
  16:./System/Src/delay.c **** //°æ±¾£ºV1.8
  17:./System/Src/delay.c **** //°æÈ¨ËùÓĞ£¬µÁ°æ±Ø¾¿¡£
  18:./System/Src/delay.c **** //Copyright(C) ¹ãÖİÊĞĞÇÒíµç×Ó¿Æ¼¼ÓĞÏŞ¹«Ë¾ 2009-2019
  19:./System/Src/delay.c **** //All rights reserved
  20:./System/Src/delay.c **** //********************************************************************************
  21:./System/Src/delay.c **** //V1.2ĞŞ¸ÄËµÃ÷
  22:./System/Src/delay.c **** //ĞŞÕıÁËÖĞ¶ÏÖĞµ÷ÓÃ³öÏÖËÀÑ­»·µÄ´íÎó
  23:./System/Src/delay.c **** //·ÀÖ¹ÑÓÊ±²»×¼È·,²ÉÓÃdo while½á¹¹!
  24:./System/Src/delay.c **** //V1.3ĞŞ¸ÄËµÃ÷
  25:./System/Src/delay.c **** //Ôö¼ÓÁË¶ÔUCOSIIÑÓÊ±µÄÖ§³Ö.
  26:./System/Src/delay.c **** //Èç¹ûÊ¹ÓÃucosII,delay_init»á×Ô¶¯ÉèÖÃSYSTICKµÄÖµ,Ê¹Ö®ÓëucosµÄTICKS_PER_SEC¶ÔÓ¦.
  27:./System/Src/delay.c **** //delay_msºÍdelay_usÒ²½øĞĞÁËÕë¶ÔucosµÄ¸ÄÔì.
  28:./System/Src/delay.c **** //delay_us¿ÉÒÔÔÚucosÏÂÊ¹ÓÃ,¶øÇÒ×¼È·¶ÈºÜ¸ß,¸üÖØÒªµÄÊÇÃ»ÓĞÕ¼ÓÃ¶îÍâµÄ¶¨Ê±Æ÷.
  29:./System/Src/delay.c **** //delay_msÔÚucosÏÂ,¿ÉÒÔµ±³ÉOSTimeDlyÀ´ÓÃ,ÔÚÎ´Æô¶¯ucosÊ±,Ëü²ÉÓÃdelay_usÊµÏÖ,´Ó¶ø×¼È·ÑÓÊ±
  30:./System/Src/delay.c **** //¿ÉÒÔÓÃÀ´³õÊ¼»¯ÍâÉè,ÔÚÆô¶¯ÁËucosÖ®ºódelay_ms¸ù¾İÑÓÊ±µÄ³¤¶Ì,Ñ¡ÔñOSTimeDlyÊµÏÖ»òÕßdelay_usÊµÏÖ.
  31:./System/Src/delay.c **** //V1.4ĞŞ¸ÄËµÃ÷ 20110929
ARM GAS  /tmp/ccxtKKLF.s 			page 2


  32:./System/Src/delay.c **** //ĞŞ¸ÄÁËÊ¹ÓÃucos,µ«ÊÇucosÎ´Æô¶¯µÄÊ±ºò,delay_msÖĞÖĞ¶ÏÎŞ·¨ÏìÓ¦µÄbug.
  33:./System/Src/delay.c **** //V1.5ĞŞ¸ÄËµÃ÷ 20120902
  34:./System/Src/delay.c **** //ÔÚdelay_us¼ÓÈëucosÉÏËø£¬·ÀÖ¹ÓÉÓÚucos´ò¶Ïdelay_usµÄÖ´ĞĞ£¬¿ÉÄÜµ¼ÖÂµÄÑÓÊ±²»×¼¡£
  35:./System/Src/delay.c **** //V1.6ĞŞ¸ÄËµÃ÷ 20150109
  36:./System/Src/delay.c **** //ÔÚdelay_ms¼ÓÈëOSLockNestingÅĞ¶Ï¡£
  37:./System/Src/delay.c **** //V1.7ĞŞ¸ÄËµÃ÷ 20150319
  38:./System/Src/delay.c **** //ĞŞ¸ÄOSÖ§³Ö·½Ê½,ÒÔÖ§³ÖÈÎÒâOS(²»ÏŞÓÚUCOSIIºÍUCOSIII,ÀíÂÛÉÏÈÎÒâOS¶¼¿ÉÒÔÖ§³Ö)
  39:./System/Src/delay.c **** //Ìí¼Ó:delay_osrunning/delay_ostickspersec/delay_osintnestingÈı¸öºê¶¨Òå
  40:./System/Src/delay.c **** //Ìí¼Ó:delay_osschedlock/delay_osschedunlock/delay_ostimedlyÈı¸öº¯Êı
  41:./System/Src/delay.c **** //V1.8ĞŞ¸ÄËµÃ÷ 20150519
  42:./System/Src/delay.c **** //ĞŞÕıUCOSIIIÖ§³ÖÊ±µÄ2¸öbug£º
  43:./System/Src/delay.c **** //delay_tickspersec¸ÄÎª£ºdelay_ostickspersec
  44:./System/Src/delay.c **** //delay_intnesting¸ÄÎª£ºdelay_osintnesting
  45:./System/Src/delay.c **** //////////////////////////////////////////////////////////////////////////////////  
  46:./System/Src/delay.c **** 
  47:./System/Src/delay.c **** static u32 fac_us=0;							//usÑÓÊ±±¶³ËÊı
  48:./System/Src/delay.c **** 
  49:./System/Src/delay.c **** #if SYSTEM_SUPPORT_OS		
  50:./System/Src/delay.c ****     static u16 fac_ms=0;				        //msÑÓÊ±±¶³ËÊı,ÔÚosÏÂ,´ú±íÃ¿¸ö½ÚÅÄµÄmsÊı
  51:./System/Src/delay.c **** #endif
  52:./System/Src/delay.c **** 	
  53:./System/Src/delay.c **** #if SYSTEM_SUPPORT_OS							//Èç¹ûSYSTEM_SUPPORT_OS¶¨ÒåÁË,ËµÃ÷ÒªÖ§³ÖOSÁË(²»ÏŞÓÚUCOS).
  54:./System/Src/delay.c **** //µ±delay_us/delay_msĞèÒªÖ§³ÖOSµÄÊ±ºòĞèÒªÈı¸öÓëOSÏà¹ØµÄºê¶¨ÒåºÍº¯ÊıÀ´Ö§³Ö
  55:./System/Src/delay.c **** //Ê×ÏÈÊÇ3¸öºê¶¨Òå:
  56:./System/Src/delay.c **** //    delay_osrunning:ÓÃÓÚ±íÊ¾OSµ±Ç°ÊÇ·ñÕıÔÚÔËĞĞ,ÒÔ¾ö¶¨ÊÇ·ñ¿ÉÒÔÊ¹ÓÃÏà¹Øº¯Êı
  57:./System/Src/delay.c **** //delay_ostickspersec:ÓÃÓÚ±íÊ¾OSÉè¶¨µÄÊ±ÖÓ½ÚÅÄ,delay_init½«¸ù¾İÕâ¸ö²ÎÊıÀ´³õÊ¼¹şsystick
  58:./System/Src/delay.c **** // delay_osintnesting:ÓÃÓÚ±íÊ¾OSÖĞ¶ÏÇ¶Ì×¼¶±ğ,ÒòÎªÖĞ¶ÏÀïÃæ²»¿ÉÒÔµ÷¶È,delay_msÊ¹ÓÃ¸Ã²ÎÊıÀ´¾ö¶¨ÈçºÎÔËĞ
  59:./System/Src/delay.c **** //È»ºóÊÇ3¸öº¯Êı:
  60:./System/Src/delay.c **** //  delay_osschedlock:ÓÃÓÚËø¶¨OSÈÎÎñµ÷¶È,½ûÖ¹µ÷¶È
  61:./System/Src/delay.c **** //delay_osschedunlock:ÓÃÓÚ½âËøOSÈÎÎñµ÷¶È,ÖØĞÂ¿ªÆôµ÷¶È
  62:./System/Src/delay.c **** //    delay_ostimedly:ÓÃÓÚOSÑÓÊ±,¿ÉÒÔÒıÆğÈÎÎñµ÷¶È.
  63:./System/Src/delay.c **** 
  64:./System/Src/delay.c **** //±¾Àı³Ì½ö×÷UCOSIIºÍUCOSIIIµÄÖ§³Ö,ÆäËûOS,Çë×ÔĞĞ²Î¿¼×ÅÒÆÖ²
  65:./System/Src/delay.c **** //Ö§³ÖUCOSII
  66:./System/Src/delay.c **** #ifdef 	OS_CRITICAL_METHOD						//OS_CRITICAL_METHOD¶¨ÒåÁË,ËµÃ÷ÒªÖ§³ÖUCOSII				
  67:./System/Src/delay.c **** #define delay_osrunning		OSRunning			//OSÊÇ·ñÔËĞĞ±ê¼Ç,0,²»ÔËĞĞ;1,ÔÚÔËĞĞ
  68:./System/Src/delay.c **** #define delay_ostickspersec	OS_TICKS_PER_SEC	//OSÊ±ÖÓ½ÚÅÄ,¼´Ã¿Ãëµ÷¶È´ÎÊı
  69:./System/Src/delay.c **** #define delay_osintnesting 	OSIntNesting		//ÖĞ¶ÏÇ¶Ì×¼¶±ğ,¼´ÖĞ¶ÏÇ¶Ì×´ÎÊı
  70:./System/Src/delay.c **** #endif
  71:./System/Src/delay.c **** 
  72:./System/Src/delay.c **** //Ö§³ÖUCOSIII
  73:./System/Src/delay.c **** #ifdef 	CPU_CFG_CRITICAL_METHOD					//CPU_CFG_CRITICAL_METHOD¶¨ÒåÁË,ËµÃ÷ÒªÖ§³ÖUCOSIII	
  74:./System/Src/delay.c **** #define delay_osrunning		OSRunning			//OSÊÇ·ñÔËĞĞ±ê¼Ç,0,²»ÔËĞĞ;1,ÔÚÔËĞĞ
  75:./System/Src/delay.c **** #define delay_ostickspersec	OSCfg_TickRate_Hz	//OSÊ±ÖÓ½ÚÅÄ,¼´Ã¿Ãëµ÷¶È´ÎÊı
  76:./System/Src/delay.c **** #define delay_osintnesting 	OSIntNestingCtr		//ÖĞ¶ÏÇ¶Ì×¼¶±ğ,¼´ÖĞ¶ÏÇ¶Ì×´ÎÊı
  77:./System/Src/delay.c **** #endif
  78:./System/Src/delay.c **** 
  79:./System/Src/delay.c **** 
  80:./System/Src/delay.c **** //us¼¶ÑÓÊ±Ê±,¹Ø±ÕÈÎÎñµ÷¶È(·ÀÖ¹´ò¶Ïus¼¶ÑÓ³Ù)
  81:./System/Src/delay.c **** void delay_osschedlock(void)
  82:./System/Src/delay.c **** {
  83:./System/Src/delay.c **** #ifdef CPU_CFG_CRITICAL_METHOD   				//Ê¹ÓÃUCOSIII
  84:./System/Src/delay.c **** 	OS_ERR err; 
  85:./System/Src/delay.c **** 	OSSchedLock(&err);							//UCOSIIIµÄ·½Ê½,½ûÖ¹µ÷¶È£¬·ÀÖ¹´ò¶ÏusÑÓÊ±
  86:./System/Src/delay.c **** #else											//·ñÔòUCOSII
  87:./System/Src/delay.c **** 	OSSchedLock();								//UCOSIIµÄ·½Ê½,½ûÖ¹µ÷¶È£¬·ÀÖ¹´ò¶ÏusÑÓÊ±
  88:./System/Src/delay.c **** #endif
ARM GAS  /tmp/ccxtKKLF.s 			page 3


  89:./System/Src/delay.c **** }
  90:./System/Src/delay.c **** 
  91:./System/Src/delay.c **** //us¼¶ÑÓÊ±Ê±,»Ö¸´ÈÎÎñµ÷¶È
  92:./System/Src/delay.c **** void delay_osschedunlock(void)
  93:./System/Src/delay.c **** {	
  94:./System/Src/delay.c **** #ifdef CPU_CFG_CRITICAL_METHOD   				//Ê¹ÓÃUCOSIII
  95:./System/Src/delay.c **** 	OS_ERR err; 
  96:./System/Src/delay.c **** 	OSSchedUnlock(&err);						//UCOSIIIµÄ·½Ê½,»Ö¸´µ÷¶È
  97:./System/Src/delay.c **** #else											//·ñÔòUCOSII
  98:./System/Src/delay.c **** 	OSSchedUnlock();							//UCOSIIµÄ·½Ê½,»Ö¸´µ÷¶È
  99:./System/Src/delay.c **** #endif
 100:./System/Src/delay.c **** }
 101:./System/Src/delay.c **** 
 102:./System/Src/delay.c **** //µ÷ÓÃOS×Ô´øµÄÑÓÊ±º¯ÊıÑÓÊ±
 103:./System/Src/delay.c **** //ticks:ÑÓÊ±µÄ½ÚÅÄÊı
 104:./System/Src/delay.c **** void delay_ostimedly(u32 ticks)
 105:./System/Src/delay.c **** {
 106:./System/Src/delay.c **** #ifdef CPU_CFG_CRITICAL_METHOD
 107:./System/Src/delay.c **** 	OS_ERR err; 
 108:./System/Src/delay.c **** 	OSTimeDly(ticks,OS_OPT_TIME_PERIODIC,&err);	//UCOSIIIÑÓÊ±²ÉÓÃÖÜÆÚÄ£Ê½
 109:./System/Src/delay.c **** #else
 110:./System/Src/delay.c **** 	OSTimeDly(ticks);							//UCOSIIÑÓÊ±
 111:./System/Src/delay.c **** #endif 
 112:./System/Src/delay.c **** }
 113:./System/Src/delay.c ****  
 114:./System/Src/delay.c **** //systickÖĞ¶Ï·şÎñº¯Êı,Ê¹ÓÃucosÊ±ÓÃµ½
 115:./System/Src/delay.c **** void SysTick_Handler(void)
 116:./System/Src/delay.c **** {	
 117:./System/Src/delay.c **** 	if(delay_osrunning==1)						//OS¿ªÊ¼ÅÜÁË,²ÅÖ´ĞĞÕı³£µÄµ÷¶È´¦Àí
 118:./System/Src/delay.c **** 	{
 119:./System/Src/delay.c **** 		OSIntEnter();							//½øÈëÖĞ¶Ï
 120:./System/Src/delay.c **** 		OSTimeTick();       					//µ÷ÓÃucosµÄÊ±ÖÓ·şÎñ³ÌĞò               
 121:./System/Src/delay.c **** 		OSIntExit();       	 					//´¥·¢ÈÎÎñÇĞ»»ÈíÖĞ¶Ï
 122:./System/Src/delay.c **** 	}
 123:./System/Src/delay.c **** }
 124:./System/Src/delay.c **** #endif
 125:./System/Src/delay.c **** 
 126:./System/Src/delay.c **** 			   
 127:./System/Src/delay.c **** //³õÊ¼»¯ÑÓ³Ùº¯Êı
 128:./System/Src/delay.c **** //µ±Ê¹ÓÃucosµÄÊ±ºò,´Ëº¯Êı»á³õÊ¼»¯ucosµÄÊ±ÖÓ½ÚÅÄ
 129:./System/Src/delay.c **** //SYSTICKµÄÊ±ÖÓ¹Ì¶¨ÎªAHBÊ±ÖÓ
 130:./System/Src/delay.c **** //SYSCLK:ÏµÍ³Ê±ÖÓÆµÂÊ
 131:./System/Src/delay.c **** void delay_init(u8 SYSCLK)
 132:./System/Src/delay.c **** {
  28              		.loc 1 132 0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              	.LVL0:
  33 0000 10B5     		push	{r4, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 8
  36              		.cfi_offset 4, -8
  37              		.cfi_offset 14, -4
  38 0002 0446     		mov	r4, r0
 133:./System/Src/delay.c **** #if SYSTEM_SUPPORT_OS 						//Èç¹ûĞèÒªÖ§³ÖOS.
 134:./System/Src/delay.c **** 	u32 reload;
ARM GAS  /tmp/ccxtKKLF.s 			page 4


 135:./System/Src/delay.c **** #endif
 136:./System/Src/delay.c ****     HAL_SYSTICK_CLKSourceConfig(SYSTICK_CLKSOURCE_HCLK);//SysTickÆµÂÊÎªHCLK
  39              		.loc 1 136 0
  40 0004 0420     		movs	r0, #4
  41              	.LVL1:
  42 0006 FFF7FEFF 		bl	HAL_SYSTICK_CLKSourceConfig
  43              	.LVL2:
 137:./System/Src/delay.c **** 	fac_us=SYSCLK;						//²»ÂÛÊÇ·ñÊ¹ÓÃOS,fac_us¶¼ĞèÒªÊ¹ÓÃ
  44              		.loc 1 137 0
  45 000a 014B     		ldr	r3, .L3
  46 000c 1C60     		str	r4, [r3]
  47 000e 10BD     		pop	{r4, pc}
  48              	.L4:
  49              		.align	2
  50              	.L3:
  51 0010 00000000 		.word	.LANCHOR0
  52              		.cfi_endproc
  53              	.LFE64:
  55              		.section	.text.delay_us,"ax",%progbits
  56              		.align	2
  57              		.global	delay_us
  58              		.thumb
  59              		.thumb_func
  61              	delay_us:
  62              	.LFB65:
 138:./System/Src/delay.c **** #if SYSTEM_SUPPORT_OS 						//Èç¹ûĞèÒªÖ§³ÖOS.
 139:./System/Src/delay.c **** 	reload=SYSCLK;					    //Ã¿ÃëÖÓµÄ¼ÆÊı´ÎÊı µ¥Î»ÎªK	   
 140:./System/Src/delay.c **** 	reload*=1000000/delay_ostickspersec;	//¸ù¾İdelay_ostickspersecÉè¶¨Òç³öÊ±¼ä
 141:./System/Src/delay.c **** 											//reloadÎª24Î»¼Ä´æÆ÷,×î´óÖµ:16777216,ÔÚ72MÏÂ,Ô¼ºÏ0.233s×óÓÒ	
 142:./System/Src/delay.c **** 	fac_ms=1000/delay_ostickspersec;		//´ú±íOS¿ÉÒÔÑÓÊ±µÄ×îÉÙµ¥Î»	   
 143:./System/Src/delay.c **** 	SysTick->CTRL|=SysTick_CTRL_TICKINT_Msk;//¿ªÆôSYSTICKÖĞ¶Ï
 144:./System/Src/delay.c **** 	SysTick->LOAD=reload; 					//Ã¿1/OS_TICKS_PER_SECÃëÖĞ¶ÏÒ»´Î	
 145:./System/Src/delay.c **** 	SysTick->CTRL|=SysTick_CTRL_ENABLE_Msk; //¿ªÆôSYSTICK
 146:./System/Src/delay.c **** #else
 147:./System/Src/delay.c **** #endif
 148:./System/Src/delay.c **** }								    
 149:./System/Src/delay.c **** 
 150:./System/Src/delay.c **** #if SYSTEM_SUPPORT_OS 						//Èç¹ûĞèÒªÖ§³ÖOS.
 151:./System/Src/delay.c **** //ÑÓÊ±nus
 152:./System/Src/delay.c **** //nus:ÒªÑÓÊ±µÄusÊı.	
 153:./System/Src/delay.c **** //nus:0~190887435(×î´óÖµ¼´2^32/fac_us@fac_us=22.5)	    								   
 154:./System/Src/delay.c **** void delay_us(u32 nus)
 155:./System/Src/delay.c **** {		
 156:./System/Src/delay.c **** 	u32 ticks;
 157:./System/Src/delay.c **** 	u32 told,tnow,tcnt=0;
 158:./System/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADµÄÖµ	    	 
 159:./System/Src/delay.c **** 	ticks=nus*fac_us; 						//ĞèÒªµÄ½ÚÅÄÊı 
 160:./System/Src/delay.c **** 	delay_osschedlock();					//×èÖ¹OSµ÷¶È£¬·ÀÖ¹´ò¶ÏusÑÓÊ±
 161:./System/Src/delay.c **** 	told=SysTick->VAL;        				//¸Õ½øÈëÊ±µÄ¼ÆÊıÆ÷Öµ
 162:./System/Src/delay.c **** 	while(1)
 163:./System/Src/delay.c **** 	{
 164:./System/Src/delay.c **** 		tnow=SysTick->VAL;	
 165:./System/Src/delay.c **** 		if(tnow!=told)
 166:./System/Src/delay.c **** 		{	    
 167:./System/Src/delay.c **** 			if(tnow<told)tcnt+=told-tnow;	//ÕâÀï×¢ÒâÒ»ÏÂSYSTICKÊÇÒ»¸öµİ¼õµÄ¼ÆÊıÆ÷¾Í¿ÉÒÔÁË.
 168:./System/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 169:./System/Src/delay.c **** 			told=tnow;
ARM GAS  /tmp/ccxtKKLF.s 			page 5


 170:./System/Src/delay.c **** 			if(tcnt>=ticks)break;			//Ê±¼ä³¬¹ı/µÈÓÚÒªÑÓ³ÙµÄÊ±¼ä,ÔòÍË³ö.
 171:./System/Src/delay.c **** 		}  
 172:./System/Src/delay.c **** 	};
 173:./System/Src/delay.c **** 	delay_osschedunlock();					//»Ö¸´OSµ÷¶È											    
 174:./System/Src/delay.c **** }  
 175:./System/Src/delay.c **** //ÑÓÊ±nms
 176:./System/Src/delay.c **** //nms:ÒªÑÓÊ±µÄmsÊı
 177:./System/Src/delay.c **** //nms:0~65535
 178:./System/Src/delay.c **** void delay_ms(u16 nms)
 179:./System/Src/delay.c **** {	
 180:./System/Src/delay.c **** 	if(delay_osrunning&&delay_osintnesting==0)//Èç¹ûOSÒÑ¾­ÔÚÅÜÁË,²¢ÇÒ²»ÊÇÔÚÖĞ¶ÏÀïÃæ(ÖĞ¶ÏÀïÃæ²»ÄÜÈÎÎñµ÷
 181:./System/Src/delay.c **** 	{		 
 182:./System/Src/delay.c **** 		if(nms>=fac_ms)						//ÑÓÊ±µÄÊ±¼ä´óÓÚOSµÄ×îÉÙÊ±¼äÖÜÆÚ 
 183:./System/Src/delay.c **** 		{ 
 184:./System/Src/delay.c ****    			delay_ostimedly(nms/fac_ms);	//OSÑÓÊ±
 185:./System/Src/delay.c **** 		}
 186:./System/Src/delay.c **** 		nms%=fac_ms;						//OSÒÑ¾­ÎŞ·¨Ìá¹©ÕâÃ´Ğ¡µÄÑÓÊ±ÁË,²ÉÓÃÆÕÍ¨·½Ê½ÑÓÊ±    
 187:./System/Src/delay.c **** 	}
 188:./System/Src/delay.c **** 	delay_us((u32)(nms*1000));				//ÆÕÍ¨·½Ê½ÑÓÊ±
 189:./System/Src/delay.c **** }
 190:./System/Src/delay.c **** #else  //²»ÓÃucosÊ±
 191:./System/Src/delay.c **** 
 192:./System/Src/delay.c **** //ÑÓÊ±nus
 193:./System/Src/delay.c **** //nusÎªÒªÑÓÊ±µÄusÊı.	
 194:./System/Src/delay.c **** //nus:0~190887435(×î´óÖµ¼´2^32/fac_us@fac_us=22.5)	 
 195:./System/Src/delay.c **** void delay_us(u32 nus)
 196:./System/Src/delay.c **** {		
  63              		.loc 1 196 0
  64              		.cfi_startproc
  65              		@ args = 0, pretend = 0, frame = 0
  66              		@ frame_needed = 0, uses_anonymous_args = 0
  67              		@ link register save eliminated.
  68              	.LVL3:
  69 0000 30B4     		push	{r4, r5}
  70              	.LCFI1:
  71              		.cfi_def_cfa_offset 8
  72              		.cfi_offset 4, -8
  73              		.cfi_offset 5, -4
  74              	.LVL4:
 197:./System/Src/delay.c **** 	u32 ticks;
 198:./System/Src/delay.c **** 	u32 told,tnow,tcnt=0;
 199:./System/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADµÄÖµ	    	 
  75              		.loc 1 199 0
  76 0002 0C4A     		ldr	r2, .L11
  77 0004 5568     		ldr	r5, [r2, #4]
  78              	.LVL5:
 200:./System/Src/delay.c **** 	ticks=nus*fac_us; 						//ĞèÒªµÄ½ÚÅÄÊı 
  79              		.loc 1 200 0
  80 0006 0C4B     		ldr	r3, .L11+4
  81 0008 1B68     		ldr	r3, [r3]
  82 000a 00FB03F0 		mul	r0, r0, r3
  83              	.LVL6:
 201:./System/Src/delay.c **** 	told=SysTick->VAL;        				//¸Õ½øÈëÊ±µÄ¼ÆÊıÆ÷Öµ
  84              		.loc 1 201 0
  85 000e 9368     		ldr	r3, [r2, #8]
  86              	.LVL7:
 198:./System/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADµÄÖµ	    	 
ARM GAS  /tmp/ccxtKKLF.s 			page 6


  87              		.loc 1 198 0
  88 0010 0021     		movs	r1, #0
  89              	.LVL8:
  90              	.L9:
  91 0012 1A46     		mov	r2, r3
  92              	.LVL9:
  93              	.L6:
 202:./System/Src/delay.c **** 	while(1)
 203:./System/Src/delay.c **** 	{
 204:./System/Src/delay.c **** 		tnow=SysTick->VAL;	
  94              		.loc 1 204 0
  95 0014 074B     		ldr	r3, .L11
  96 0016 9B68     		ldr	r3, [r3, #8]
  97              	.LVL10:
 205:./System/Src/delay.c **** 		if(tnow!=told)
  98              		.loc 1 205 0
  99 0018 9A42     		cmp	r2, r3
 100 001a FBD0     		beq	.L6
 206:./System/Src/delay.c **** 		{	    
 207:./System/Src/delay.c **** 			if(tnow<told)tcnt+=told-tnow;	//ÕâÀï×¢ÒâÒ»ÏÂSYSTICKÊÇÒ»¸öµİ¼õµÄ¼ÆÊıÆ÷¾Í¿ÉÒÔÁË.
 101              		.loc 1 207 0
 102 001c 02D9     		bls	.L7
 103              		.loc 1 207 0 is_stmt 0 discriminator 1
 104 001e D21A     		subs	r2, r2, r3
 105 0020 1144     		add	r1, r1, r2
 106              	.LVL11:
 107 0022 02E0     		b	.L8
 108              	.L7:
 208:./System/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 109              		.loc 1 208 0 is_stmt 1
 110 0024 EC1A     		subs	r4, r5, r3
 111 0026 2244     		add	r2, r2, r4
 112 0028 1144     		add	r1, r1, r2
 113              	.LVL12:
 114              	.L8:
 209:./System/Src/delay.c **** 			told=tnow;
 210:./System/Src/delay.c **** 			if(tcnt>=ticks)break;			//Ê±¼ä³¬¹ı/µÈÓÚÒªÑÓ³ÙµÄÊ±¼ä,ÔòÍË³ö.
 115              		.loc 1 210 0
 116 002a 8142     		cmp	r1, r0
 117 002c F1D3     		bcc	.L9
 211:./System/Src/delay.c **** 		}  
 212:./System/Src/delay.c **** 	};
 213:./System/Src/delay.c **** }
 118              		.loc 1 213 0
 119 002e 30BC     		pop	{r4, r5}
 120              	.LCFI2:
 121              		.cfi_restore 5
 122              		.cfi_restore 4
 123              		.cfi_def_cfa_offset 0
 124              	.LVL13:
 125 0030 7047     		bx	lr
 126              	.L12:
 127 0032 00BF     		.align	2
 128              	.L11:
 129 0034 10E000E0 		.word	-536813552
 130 0038 00000000 		.word	.LANCHOR0
 131              		.cfi_endproc
ARM GAS  /tmp/ccxtKKLF.s 			page 7


 132              	.LFE65:
 134              		.section	.text.delay_ms,"ax",%progbits
 135              		.align	2
 136              		.global	delay_ms
 137              		.thumb
 138              		.thumb_func
 140              	delay_ms:
 141              	.LFB66:
 214:./System/Src/delay.c **** 
 215:./System/Src/delay.c **** //ÑÓÊ±nms
 216:./System/Src/delay.c **** //nms:ÒªÑÓÊ±µÄmsÊı
 217:./System/Src/delay.c **** void delay_ms(u16 nms)
 218:./System/Src/delay.c **** {
 142              		.loc 1 218 0
 143              		.cfi_startproc
 144              		@ args = 0, pretend = 0, frame = 0
 145              		@ frame_needed = 0, uses_anonymous_args = 0
 146              	.LVL14:
 147 0000 38B5     		push	{r3, r4, r5, lr}
 148              	.LCFI3:
 149              		.cfi_def_cfa_offset 16
 150              		.cfi_offset 3, -16
 151              		.cfi_offset 4, -12
 152              		.cfi_offset 5, -8
 153              		.cfi_offset 14, -4
 154 0002 0546     		mov	r5, r0
 155              	.LVL15:
 219:./System/Src/delay.c **** 	u32 i;
 220:./System/Src/delay.c **** 	for(i=0;i<nms;i++) delay_us(1000);
 156              		.loc 1 220 0
 157 0004 0024     		movs	r4, #0
 158 0006 04E0     		b	.L14
 159              	.LVL16:
 160              	.L15:
 161              		.loc 1 220 0 is_stmt 0 discriminator 3
 162 0008 4FF47A70 		mov	r0, #1000
 163 000c FFF7FEFF 		bl	delay_us
 164              	.LVL17:
 165 0010 0134     		adds	r4, r4, #1
 166              	.LVL18:
 167              	.L14:
 168              		.loc 1 220 0 discriminator 1
 169 0012 AC42     		cmp	r4, r5
 170 0014 F8D3     		bcc	.L15
 221:./System/Src/delay.c **** }
 171              		.loc 1 221 0 is_stmt 1
 172 0016 38BD     		pop	{r3, r4, r5, pc}
 173              		.cfi_endproc
 174              	.LFE66:
 176              		.section	.bss.fac_us,"aw",%nobits
 177              		.align	2
 178              		.set	.LANCHOR0,. + 0
 181              	fac_us:
 182 0000 00000000 		.space	4
 183              		.text
 184              	.Letext0:
 185              		.file 2 "/opt/toolchain/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/machine/_default_types.
ARM GAS  /tmp/ccxtKKLF.s 			page 8


 186              		.file 3 "/opt/toolchain/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/sys/_stdint.h"
 187              		.file 4 "Drivers/CMSIS/Inc/core_cm3.h"
 188              		.file 5 "System/Inc/sys.h"
 189              		.file 6 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_cortex.h"
ARM GAS  /tmp/ccxtKKLF.s 			page 9


DEFINED SYMBOLS
                            *ABS*:00000000 delay.c
     /tmp/ccxtKKLF.s:20     .text.delay_init:00000000 $t
     /tmp/ccxtKKLF.s:25     .text.delay_init:00000000 delay_init
     /tmp/ccxtKKLF.s:51     .text.delay_init:00000010 $d
     /tmp/ccxtKKLF.s:56     .text.delay_us:00000000 $t
     /tmp/ccxtKKLF.s:61     .text.delay_us:00000000 delay_us
     /tmp/ccxtKKLF.s:129    .text.delay_us:00000034 $d
     /tmp/ccxtKKLF.s:135    .text.delay_ms:00000000 $t
     /tmp/ccxtKKLF.s:140    .text.delay_ms:00000000 delay_ms
     /tmp/ccxtKKLF.s:177    .bss.fac_us:00000000 $d
     /tmp/ccxtKKLF.s:181    .bss.fac_us:00000000 fac_us
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
HAL_SYSTICK_CLKSourceConfig
